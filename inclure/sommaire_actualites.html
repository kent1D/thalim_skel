[(#REM)
/**
 * Plugin Agenda 4 pour Spip 3.0
 * Licence GPL 3
 *
 * 2006-2011
 * Auteurs : cf paquet.xml
 */
]
<section id="sommaire_actualites" class="offset1 span6">
	<header>
		<h1 class="ellipse #EDIT{meta-agenda/titre}"><div class="ovale"> </div><span class="titre">[(#CONFIG{agenda/titre}|sinon{<:agenda:titre_sur_l_agenda:>}|typo)]</span></h1>
	</header>

	#SET{affichage_duree,#ENV{affichage_duree,2}}
	#SET{affichage_debut,#CONFIG{agenda/affichage_debut,#ENV{affichage_debut,date_jour}}}
	#SET{date_debut,#ENV{date}|affdate{'Y-m-d 00:00:00'}|agenda_date_debut_liste{#GET{affichage_debut}}}
	#SET{date_fin,#GET{date_debut}|agenda_moisdecal{#GET{affichage_duree},'Y-m-01 23:59:59'}|agenda_dateplus{-86400}}

 	#SET{exposition,#ARRAY}
    <BOUCLE_ev_expo(EVENEMENTS){id_rubrique=271}{!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{par date_debut}{id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}>
        <BOUCLE_ev_expo2(ARTICLES){auteurs.statut IN 0minirezo,1comite}{id_evenement=#ID_EVENEMENT}{id_mot=220}{doublons #ID_EVENEMENT}>
    	   [(#SET{cle,[(#DATE_DEBUT|replace{-,''}|replace{:,''}|replace{' ',''})_evenement_#ID_EVENEMENT]})]
           [(#SET{exposition,[(#GET{exposition}|array_merge{[(#ARRAY{#GET{cle},#ID_EVENEMENT})]})]})]
	    </BOUCLE_ev_expo2>
    </BOUCLE_ev_expo>

	#SET{prix,#ARRAY}
    <BOUCLE_ev_prix(EVENEMENTS){id_rubrique=271}{!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{par date_debut}{id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}>
        <BOUCLE_ev_prix2(ARTICLES){auteurs.statut IN 0minirezo,1comite}{id_evenement=#ID_EVENEMENT}{id_mot=1050}{doublons #ID_EVENEMENT}>
			[(#SET{cle,[(#DATE_DEBUT|replace{-,''}|replace{:,''}|replace{' ',''})_evenement_#ID_EVENEMENT]})]
			[(#SET{prix,[(#GET{prix}|array_merge{[(#ARRAY{#GET{cle},#ID_EVENEMENT})]})]})]
		</BOUCLE_ev_prix2>
	</BOUCLE_ev_prix>

    [(#REM) retrieve APPELS]
	#SET{evenements,#ARRAY}
	<BOUCLE_rubriques3(RUBRIQUES){id_rubrique=262}>
		[(#REM)Les appels qui commencent dans ce qui reste de mois]
		<BOUCLE_ev3_1(ARTICLES){auteurs.statut IN 0minirezo,1comite}{date > #ENV{date}}{date > #GET{date_debut}}{date < #GET{date_fin}}{id_mot?}{id_rubrique}{doublons}>
			[(#SET{evenements,[(#GET{evenements}|array_merge{[(#ARRAY{[(#DATE|replace{' ','_'}|replace{':','_'})]_[(#COMPTEUR_BOUCLE)],#ID_ARTICLE})]})]})]
		</BOUCLE_ev3_1>
		<BOUCLE_ev3_2(ARTICLES){auteurs.statut IN 0minirezo,1comite}{date_redac != ''}{date_redac != '0000-00-00 00:00'}{date_redac < #ENV{date}}{date > #ENV{date}}{id_mot?}{id_rubrique}{doublons}>
			[(#SET{evenements,[(#GET{evenements}|array_merge{[(#ARRAY{[(#DATE_REDAC|replace{' ','_'}|replace{':','_'})]_[(#COMPTEUR_BOUCLE)],#ID_ARTICLE})]})]})]
		</BOUCLE_ev3_2>
		<BOUCLE_ev3_21(ARTICLES){auteurs.statut IN 0minirezo,1comite}{date_redac != ''}{date_redac != '0000-00-00 00:00'}{date_redac >= #ENV{date}}{date_redac < #GET{date_fin}}{date > #GET{date_fin}}{id_mot?}{id_rubrique}{doublons}>
			[(#SET{evenements,[(#GET{evenements}|array_merge{[(#ARRAY{[(#DATE_REDAC|replace{' ','_'}|replace{':','_'})]_[(#COMPTEUR_BOUCLE)],#ID_ARTICLE})]})]})]
		</BOUCLE_ev3_21>
	</BOUCLE_rubriques3>

	#SET{publications_ouvrages,#ARRAY}
	#SET{publications_articles,#ARRAY}
	#SET{mots_ouvrages,#LISTE{463,1053}}
	#SET{type_hal_ouvrages,#LISTE{OUV,DOUV}}
	#SET{mots_articles,#LISTE{495,1052}}
	#SET{type_hal_articles,#LISTE{ART,COUV}}
	<BOUCLE_ev1(HALS_PUBLICATIONS){date_production >= #GET{date_debut}}{date_production < #GET{date_fin}}{typdoc IN #GET{type_hal_ouvrages}}{date_production != 0000-00-00 00:00:00}{!par date_production}{doublons hal_ouvrages}>
		<BOUCLE_aut_ev1(AUTEURS){statut IN 0minirezo,1comite}{id_objet = #ID_HAL}{objet=hal}{par nom}{0,1}>
		[(#SET{cle,[(#DATE_PRODUCTION|!={'0000-00-00 00:00:00'}|?{#DATE_PRODUCTION,#DATE_ECRITURE}|replace{-,''}|replace{:,''}|replace{' ',''})_hal_#ID_HALS_PUBLICATION]})]
		[(#SET{publications_ouvrages,[(#GET{publications_ouvrages}|array_merge{[(#ARRAY{#GET{cle},[(#INCLURE{fond=inclure/resume/publication_hal_newsletter,id_hals_publication,intro=non,env})]})]})]})]
		</BOUCLE_aut_ev1>
	</BOUCLE_ev1>
	<BOUCLE_ev2(HALS_PUBLICATIONS){date_production >= #GET{date_debut}}{date_production < #GET{date_fin}}{typdoc IN #GET{type_hal_ouvrages}}{date_production = 0000-00-00 00:00:00}{!par date_production}{doublons hal_ouvrages}>
		<BOUCLE_aut_ev2(AUTEURS){statut IN 0minirezo,1comite}{id_objet = #ID_HAL}{objet=hal}{par nom}{0,1}>
		[(#SET{cle,[(#DATE_PRODUCTION|!={'0000-00-00 00:00:00'}|?{#DATE_PRODUCTION,#DATE_ECRITURE}|replace{-,''}|replace{:,''}|replace{' ',''})_hal_#ID_HALS_PUBLICATION]})]
		[(#SET{publications_ouvrages,[(#GET{publications_ouvrages}|array_merge{[(#ARRAY{#GET{cle},[(#INCLURE{fond=inclure/resume/publication_hal_newsletter,id_hals_publication,intro=non,env})]})]})]})]
		</BOUCLE_aut_ev2>
	</BOUCLE_ev2>
	<BOUCLE_rubriques_pub(RUBRIQUES){racine}{composition=publications}>
		<BOUCLE_ouvrages_pub(ARTICLES){auteurs.statut IN 0minirezo,1comite}{branche}{id_mot IN #GET{mots_ouvrages}}{date >= #GET{date_debut}}{date < #GET{date_fin}}>
		    [(#SET{cle,[(#DATE|replace{-,''}|replace{:,''}|replace{' ',''})_article_#ID_ARTICLE]})]
		    #SET{publications_ouvrages,#GET{publications_ouvrages}|array_merge{#ARRAY{#GET{cle},#INCLURE{fond=inclure/resume/publication_newsletter,id_article,sans_document=oui,intro=non,env}}}}
		</BOUCLE_ouvrages_pub>
	</BOUCLE_rubriques_pub>

    #SET{evts,#ARRAY}
	<BOUCLE_rubriques2(RUBRIQUES){id_rubrique IN 247,271,267}>
        <BOUCLE_ev(EVENEMENTS){!evenement_passe #GET{date_debut}}{!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{par id_rubrique, date_debut}{id_article?}{id_mot?}{id_evenement_source?}{id_rubrique}>
            <BOUCLE_ev_autre(ARTICLES){auteurs.statut IN 0minirezo,1comite}{id_evenement=#ID_EVENEMENT}{doublons #ID_EVENEMENT}>
            [(#SET{cle,[(#DATE_DEBUT|replace{-,''}|replace{:,''}|replace{' ',''})_evenement_#ID_EVENEMENT]})]
            [(#SET{evts,[(#GET{evts}|array_merge{[(#ARRAY{#GET{cle},#ID_EVENEMENT})]})]})]
            </BOUCLE_ev_autre>
        </BOUCLE_ev>
	</BOUCLE_rubriques2>


    [(#REM)
        AFFICHE
    ]

    [(#REM) affiche EXPOS]
    [(#GET{exposition}|count|>{0}|oui) #SET{expos,ok}]
    <BOUCLE_si_expo(CONDITION){si #GET{expos}|=={ok}|oui}>
        <B_data_expo>
        <BOUCLE_data_expo(DATA){si #GET{exposition}|count|>{0}}{source tableau,#GET{exposition}}{!par cle}>
            #INCLURE{fond=inclure/resume/evenement_home_newsletter,id_evenement=#VALEUR,sans_document=oui,intro=non,env}
        </BOUCLE_data_expo>
        </B_data_expo>
    </BOUCLE_si_expo>
    [(#REM) affiche PRIX]
    [(#GET{prix}|count|>{0}|oui) #SET{prixes,ok}]
    <BOUCLE_si_prix(CONDITION){si #GET{prixes}|=={ok}|oui}>
        <B_data_prix>
        <BOUCLE_data_prix(DATA){si #GET{prix}|count|>{0}}{source tableau,#GET{prix}}{!par cle}>
            #INCLURE{fond=inclure/resume/evenement_home_newsletter,id_evenement=#VALEUR,sans_document=oui,intro=non,env}
        </BOUCLE_data_prix>
        </B_data_prix>
    </BOUCLE_si_prix>

    [(#REM) retrieve & affiche COLLOQUES]
    <BOUCLE_annee3(RUBRIQUES){id_rubrique=250}>
    <B_ev_colloque>
        <BOUCLE_ev_colloque(EVENEMENTS){id_rubrique=#ID_RUBRIQUE}{!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{par date_debut}{id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}>
            <BOUCLE_ev_colloque_thalim(ARTICLES){auteurs.statut IN 0minirezo,1comite}{id_evenement=#ID_EVENEMENT}>
                #INCLURE{fond=inclure/resume/evenement_home_newsletter,id_evenement,sans_document=oui,intro=non,env}
            </BOUCLE_ev_colloque_thalim>
        </BOUCLE_ev_colloque>
        #SET{has_event,oui}
    </B_ev_colloque>
    </BOUCLE_annee3>

    [(#REM) affiche APPELS]
    <B_ev3_3>
    <BOUCLE_ev3_3(DATA){source table,#GET{evenements}}{par cle}>
            #INCLURE{fond=inclure/resume/evenement_date_redac_newsletter,id_article=#VALEUR,sans_document=oui,intro=non,env}
    </BOUCLE_ev3_3>
    #SET{has_event,oui}
    </B_ev3_3>

    [(#REM) affiche OUVRAGES]
    [(#GET{publications_articles}|array_merge{#GET{publications_ouvrages}}|count|>{0}|oui) #SET{publications,ok}]
    <BOUCLE_si_publications(CONDITION){si #GET{publications}|=={ok}|oui}>
        <B_data_publications>
        <BOUCLE_data_publications(DATA){si #GET{publications_ouvrages}|count|>{0}}{source tableau,#GET{publications_ouvrages}}{!par cle}>
            <BOUCLE_si_val2(CONDITION){si #VALEUR|?{non,#VALEUR}}>
                #VALEUR
            </BOUCLE_si_val2>
        </BOUCLE_data_publications>
        </B_data_publications>
    </BOUCLE_si_publications>
    #SET{has_event,oui}
    </B_si_publications>

    [(#REM) retrieve & affiche SOUTENANCES]
    <BOUCLE_annee4(RUBRIQUES){id_rubrique=270}>
        <B_ev_soutenance>
        <BOUCLE_ev_soutenance(EVENEMENTS){id_rubrique=#ID_RUBRIQUE}{!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{par date_debut}{id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}>
            #INCLURE{fond=inclure/resume/evenement_home_newsletter,id_evenement,sans_document=oui,intro=non,env}
        </BOUCLE_ev_soutenance>
        #SET{has_event,oui}
        </B_ev_soutenance>
    </BOUCLE_annee4>

    [(#REM) affiche AUTRES EVTS]
    [(#GET{evts}|count|>{0}|oui) #SET{fi_evts,ok}]
    <BOUCLE_si_evts(CONDITION){si #GET{fi_evts}|=={ok}|oui}>
        <B_data_evts>
        <BOUCLE_data_evts(DATA){si #GET{evts}|count|>{0}}{source tableau,#GET{evts}}{par cle}>
            #INCLURE{fond=inclure/resume/evenement_home_newsletter,id_evenement=#VALEUR,sans_document=oui,intro=non,env}
        </BOUCLE_data_evts>
        </B_data_evts>
    </BOUCLE_si_evts>
</section>
