<BOUCLE_evenement(EVENEMENTS){id_rubrique}{date_debut <= #ENV{date}}{!par date_debut}{0,1}>
#SET{affichage_duree,#ENV{affichage_duree,#CONFIG{agenda/affichage_duree,12}}}
#SET{affichage_debut,#CONFIG{agenda/affichage_debut,#ENV{affichage_debut,date_jour}}}
#SET{date_debut,#ENV{date_debut,#DATE_DEBUT|sinon{#ENV{date}}}|affdate{'Y-m-01 H:i:00'}|agenda_date_debut_liste{#GET{affichage_debut}}}
#SET{date_prev,#GET{date_debut}|agenda_moisdecal{#GET{affichage_duree}|mult{-1},'Y-m-d H:i:00'}}
#SET{date_fin,#GET{date_debut}|agenda_moisdecal{#GET{affichage_duree},'Y-m-d H:i:00'}}
[(#ENV{id_rubrique}|in_array{#LISTE{250,270}}|oui)
	#SET{affichage_duree,12} 
	#SET{affichage_debut,#CONFIG{agenda/affichage_debut,#ENV{affichage_debut,date_jour}}}
	#SET{date_debut,#ENV{date_debut,#DATE_DEBUT}|affdate{'Y-01-01 00:00:00'}|agenda_date_debut_liste{#GET{affichage_debut}}}
	#SET{date_prev,#GET{date_debut}|agenda_moisdecal{#GET{affichage_duree}|mult{-1},'Y-m-d 00:00:00'}}
	#SET{date_fin,#GET{date_debut}|agenda_moisdecal{#GET{affichage_duree},'Y-m-d 00:00:00'}}
]
</BOUCLE_evenement>
</B_evenement>
#SET{affichage_duree,#ENV{affichage_duree,#CONFIG{agenda/affichage_duree,12}}}
#SET{affichage_debut,#CONFIG{agenda/affichage_debut,#ENV{affichage_debut,date_jour}}}
#SET{date_debut,#ENV{date_debut,#ENV{date}}|affdate{'Y-m-01 H:i:00'}|agenda_date_debut_liste{#GET{affichage_debut}}}
#SET{date_prev,#GET{date_debut}|agenda_moisdecal{#GET{affichage_duree}|mult{-1},'Y-m-d H:i:00'}}
#SET{date_fin,#GET{date_debut}|agenda_moisdecal{#GET{affichage_duree},'Y-m-d H:i:00'}}
<//B_evenement>
[(#REM) Ne pas afficher l'annee de depart, elle est dans le h2)]
[(#GET{date_debut}|annee|unique{annee}|non)]
<div id="agenda-liste" class="liste long evenements">
<h2>[(#GET{date_debut}|affdate_periode{#GET{affichage_duree},#GET{affichage_debut}})]</h2>
#SET{has_event,non}

<BOUCLE_rubriques(RUBRIQUES){id_rubrique}>
	<BOUCLE_si_rub_communications(CONDITION){si #ID_RUBRIQUE|=={251}}>
	#SET{communications,#ARRAY}
	<BOUCLE_comm1(HALS_PUBLICATIONS){typdoc IN COMM}{date_ecriture > #GET{date_debut}}{date_ecriture < #GET{date_fin}}{!par date_ecriture}{doublons hal_communications}>
	[(#SET{cle,[(#DATE_ECRITURE|!={'0000-00-00 00:00:00'}|?{#DATE_ECRITURE,#DATE_PRODUCTION}|replace{-,''}|replace{:,''}|replace{' ',''})_hal_#ID_HALS_PUBLICATION]})]
	[(#SET{communications,[(#GET{communications}|array_merge{[(#ARRAY{#GET{cle},[(#INCLURE{fond=inclure/resume/publication_hal,id_hals_publication,intro=non,afficher_auteur=non,env})]})]})]})]
	</BOUCLE_comm1>
	<BOUCLE_comm2(HALS_PUBLICATIONS){typdoc IN COMM}{date_production > #GET{date_debut}}{date_production < #GET{date_fin}}{!par date_production}{doublons hal_communications}>
	[(#SET{cle,[(#DATE_ECRITURE|!={'0000-00-00 00:00:00'}|?{#DATE_ECRITURE,#DATE_PRODUCTION}|replace{-,''}|replace{:,''}|replace{' ',''})_hal_#ID_HALS_PUBLICATION]})]
	[(#SET{communications,[(#GET{communications}|array_merge{[(#ARRAY{#GET{cle},[(#INCLURE{fond=inclure/resume/publication_hal,id_hals_publication,intro=non,afficher_auteur=non,env})]})]})]})]
	</BOUCLE_comm2>
	<BOUCLE_evcomm1(EVENEMENTS){!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{!par date_debut}{id_article?}{id_mot?}{id_evenement_source?}{id_rubrique}>
	[(#SET{cle,[(#DATE_DEBUT|replace{-,''}|replace{:,''}|replace{' ',''})_evenement_#ID_EVENEMENT]})]
	[(#SET{communications,[(#GET{communications}|array_merge{[(#ARRAY{#GET{cle},[(#INCLURE{fond=inclure/resume/evenement_home,id_evenement,intro=non,env})]})]})]})]
	</BOUCLE_evcomm1>
	<B_evcomm>
	<ul class="liste-items liste-puce evenements">
	<BOUCLE_evcomm(DATA){si #GET{communications}|count|>{0}}{source tableau,#GET{communications}}{!par cle}>
		<li class="item">
			#VALEUR
		</li>
	</BOUCLE_evcomm>
	</ul>
	</B_evcomm>
	<p>Il n'y a pas d'événement ce mois-ci</p>
	<//B_evcomm>
	</BOUCLE_si_rub_communications>
	</B_si_rub_communications>
	<B_ev1>
	<ul class="liste-items liste-puce evenements">
	<BOUCLE_ev1(EVENEMENTS){!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{!par date_debut}{id_article?}{id_mot?}{id_evenement_source?}{id_rubrique}>
		<li class="item[(#DATE_FIN|agenda_date_passee)fini]">
			#INCLURE{fond=inclure/resume/evenement_home,id_evenement,intro=non,env}
		</li>
	</BOUCLE_ev1>
	</ul>
	</B_ev1>
	[(#GET{affichage_duree,1}|=={1}|oui)
	<p>Il n'y a pas d'événement ce mois-ci</p>]
	[(#GET{affichage_duree,1}|=={12}|oui)
	<p>Il n'y a pas d'événement cette année</p>]
	<//B_ev1>
	<//B_si_rub_communications>
</BOUCLE_rubriques>
<div class="pagination">
	#SET{hasprev,''}
	<BOUCLE_prev(EVENEMENTS){id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}{!evenement_a_venir #GET{date_prev}}{0,1}>#ID_EVENEMENT #SET{hasprev,1}</BOUCLE_prev>
	</B_prev>
	<BOUCLE_prevcomm1(HALS_PUBLICATIONS){si #ENV{id_rubrique}|=={251}}{typdoc IN COMM}{date_ecriture < #GET{date_debut}}{!par date_ecriture}{doublons hal_communications}>
	#SET{hasprev,1}</BOUCLE_prevcomm1>
	<BOUCLE_prevcomm2(HALS_PUBLICATIONS){si #ENV{id_rubrique}|=={251}}{typdoc IN COMM}{date_production < #GET{date_debut}}{!par date_production}{doublons hal_communications}>
	#SET{hasprev,1}</BOUCLE_prevcomm2>
	<//B_prev>
	#SET{hasnext,''}
	<BOUCLE_next(EVENEMENTS){id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}{!evenement_passe #GET{date_fin}}{0,1}>#ID_EVENEMENT #SET{hasnext,1}</BOUCLE_next>
	</B_next>
	<BOUCLE_nextcomm1(HALS_PUBLICATIONS){si #ENV{id_rubrique}|=={251}}{typdoc IN COMM}{date_ecriture > #GET{date_fin}}{!par date_ecriture}{doublons hal_communications}>
	#SET{hasnext,1}</BOUCLE_nextcomm1>
	<BOUCLE_nextcomm2(HALS_PUBLICATIONS){si #ENV{id_rubrique}|=={251}}{typdoc IN COMM}{date_production > #GET{date_fin}}{!par date_production}{doublons hal_communications}>
	#SET{hasnext,1}</BOUCLE_nextcomm2>
	</BOUCLE_si_nextcomm>
	<//B_next>
	#GET{hasprev} - #GET{hasnext}
	[(#GET{hasprev}|=={1}|ou{#GET{hasnext}|=={1}}|oui)
	[(#INCLURE{fond=modeles/pagination_precedent_suivant,
	label_precedent=#GET{date_prev}|affdate_periode{#GET{affichage_duree}},
	label_suivant=#GET{date_fin}|affdate_periode{#GET{affichage_duree}},
	nombre_pages=#VAL{1}|plus{#GET{hasprev}|?{1,0}}|plus{#GET{hasnext}|?{1,0}},
	page_courante=#GET{hasprev}|?{2,1},
	url_precedent=#SELF|parametre_url{date_debut,#GET{date_prev}|affdate{Y-m-d}},
	url_suivant=#SELF|parametre_url{date_debut,#GET{date_fin}|affdate{Y-m-d}},
	ancre=agenda-liste,
	separateur=' | '})]]
</div>
</B_rubriques>
<BOUCLE_annee(RUBRIQUES){id_rubrique IN #LISTE{250,270}}>
<B_ev_colloque>
	<h3>#INFO_TITRE{rubrique,#ID_RUBRIQUE}</h3>
	<ul class="liste-items liste-puce evenements">
	<BOUCLE_ev_colloque(EVENEMENTS){id_rubrique=#ID_RUBRIQUE}{!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{!par date_debut}{id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}>
		<li class="item[(#DATE_FIN|agenda_date_passee)fini]">
			#INCLURE{fond=inclure/resume/evenement_home,id_evenement,env}
		</li>
	</BOUCLE_ev_colloque>
	</ul>
	#SET{has_event,oui}
</B_ev_colloque>
</BOUCLE_annee>
<B_publications>
<h3>#INFO_TITRE{rubrique,3}</h3>
<ul class="liste-items liste-puce evenements">
<BOUCLE_publications(ARTICLES){id_secteur = 3}{date >= #GET{date_debut}}{date <= #GET{date_fin}}{!par date}>
	<li>#INCLURE{fond=inclure/resume/publication,id_article,env}</li>
</BOUCLE_publications>
</ul>
#SET{has_event,oui}
</B_publications>
<BOUCLE_rubriques2(RUBRIQUES){id_rubrique IN 247,251,267}>
<BOUCLE_si_communication(CONDITION){si #ID_RUBRIQUE|=={251}}>
#SET{communications,#ARRAY}
	<BOUCLE_comm12(HALS_PUBLICATIONS){typdoc IN COMM}{date_ecriture > #GET{date_debut}}{date_ecriture < #GET{date_fin}}{!par date_ecriture}{doublons hal_communications_bis}>
	[(#SET{cle,[(#DATE_ECRITURE|!={'0000-00-00 00:00:00'}|?{#DATE_ECRITURE,#DATE_PRODUCTION}|replace{-,''}|replace{:,''}|replace{' ',''})_hal_#ID_HALS_PUBLICATION]})]
	[(#SET{communications,[(#GET{communications}|array_merge{[(#ARRAY{#GET{cle},[(#INCLURE{fond=inclure/resume/publication_hal,id_hals_publication,intro=non,afficher_auteur=non,env})]})]})]})]
	</BOUCLE_comm12>
	<BOUCLE_comm22(HALS_PUBLICATIONS){typdoc IN COMM}{date_production > #GET{date_debut}}{date_production < #GET{date_fin}}{!par date_production}{doublons hal_communications_bis}>
	[(#SET{cle,[(#DATE_ECRITURE|!={'0000-00-00 00:00:00'}|?{#DATE_ECRITURE,#DATE_PRODUCTION}|replace{-,''}|replace{:,''}|replace{' ',''})_hal_#ID_HALS_PUBLICATION]})]
	[(#SET{communications,[(#GET{communications}|array_merge{[(#ARRAY{#GET{cle},[(#INCLURE{fond=inclure/resume/publication_hal,id_hals_publication,intro=non,afficher_auteur=non,env})]})]})]})]
	</BOUCLE_comm22>
	<BOUCLE_evcomm12(EVENEMENTS){!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{!par date_debut}{id_article?}{id_mot?}{id_evenement_source?}{id_rubrique}>
	[(#SET{cle,[(#DATE_DEBUT|replace{-,''}|replace{:,''}|replace{' ',''})_evenement_#ID_EVENEMENT]})]
	[(#SET{communications,[(#GET{communications}|array_merge{[(#ARRAY{#GET{cle},[(#INCLURE{fond=inclure/resume/evenement_home,id_evenement,intro=non,env})]})]})]})]
	</BOUCLE_evcomm12>
	<B_evcomm2>
	<h3>#_rubriques2:TITRE</h3>
	<ul class="liste-items liste-puce evenements">
	<BOUCLE_evcomm2(DATA){si #GET{communications}|count|>{0}}{source tableau,#GET{communications}}{!par cle}>
		<li class="item">
			#VALEUR
		</li>
	</BOUCLE_evcomm2>
	</ul>
	#SET{has_event,oui}
	</B_evcomm2>
</BOUCLE_si_communication>
</B_si_communication>
<B_ev>
	<h3>#TITRE</h3>
	[(#ID_RUBRIQUE|=={251}|oui)<p><:thalim:message_par_membre_thalim:></p>]
	<ul class="liste-items liste-puce evenements">
	<BOUCLE_ev(EVENEMENTS){!evenement_passe #GET{date_debut}}{!evenement_a_venir #GET{date_fin}}{!par date_debut}{id_article?}{id_mot?}{id_evenement_source?}{id_rubrique}>
		<li class="item[(#DATE_FIN|agenda_date_passee)fini]">
			#INCLURE{fond=inclure/resume/evenement_home,id_evenement,intro=non,env}
		</li>
	</BOUCLE_ev>
	</ul>
	#SET{has_event,oui}
</B_ev>
<//B_si_communication>
</BOUCLE_rubriques2>
<div class="pagination">
	#SET{hasprev,''}
	<BOUCLE_prev1(EVENEMENTS){id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}{!evenement_a_venir #GET{date_prev}}{0,1}>#ID_EVENEMENT #SET{hasprev,1}</BOUCLE_prev1>
	#SET{hasnext,''}
	<BOUCLE_next1(EVENEMENTS){id_article?}{id_rubrique?}{id_mot?}{id_evenement_source?}{!evenement_passe #GET{date_fin}}{0,1}>#ID_EVENEMENT #SET{hasnext,1}</BOUCLE_next1>
	[(#GET{hasprev}|=={1}|ou{#GET{hasnext}|=={1}}|oui)
	[(#INCLURE{fond=modeles/pagination_precedent_suivant,
	label_precedent=#GET{date_prev}|affdate_periode{#GET{affichage_duree}},
	label_suivant=#GET{date_fin}|affdate_periode{#GET{affichage_duree}},
	nombre_pages=#VAL{1}|plus{#GET{hasprev}|?{1,0}}|plus{#GET{hasnext}|?{1,0}},
	page_courante=#GET{hasprev}|?{2,1},
	url_precedent=#SELF|parametre_url{date_debut,#GET{date_prev}|affdate{Y-m-d}},
	url_suivant=#SELF|parametre_url{date_debut,#GET{date_fin}|affdate{Y-m-d}},
	ancre=agenda-liste,
	separateur=' | '})]]
</div>
[(#GET{has_event}|=={non}|oui)
	<p><:agenda:info_aucun_evenement:></p>
]
<//B_rubriques>
</div>